# WOPA: Intelligent Chat Safeguarder
WOPA is a proof-of-concept security tool that leverages Large Language Models (LLMs) and sandboxing techniques to analyze and protect real-time chat environments. 
By integrating flexible microservices, LLM-based reasoning, and automated testing strategies, WOPA aims to identify suspicious messages, links, and files before they impact users.
*Note* This majority of code in this repo is generated by LLM agents.

## Key Features
- Context-Aware Analysis: Uses LLM reasoning to interpret messages, links, and files beyond simple pattern matching.
- Microservice Architecture: Modular design allows quick updates, seamless integration of new analyzers, and rapid adaptation to evolving threats.
- Scalable & Documented: Nearly 10k lines of code and over 6k lines of supporting documents ensure clarity, facilitating easy onboarding of new contributors and automated agents.
- Operator-Based Workflows: Guided by philosophical principles and well-defined prompts, agents collaborate effectively with minimal human oversight.

## General Architecture
![Architecture](https://github.com/user-attachments/assets/34c557ce-e970-44fa-b1ad-a9829f7e1f5a)

## Get Started
- Full System with Docker Compose
Run ``git clone https://github.com/wDANDANw/wopa.git`` to clone the repo.

- After pulling, ensure you have docker and docker compose.
- Run ``docker compose up -d`` to spin up the whole system (with all five subsystems)
- Or run ``docker compose up -d <subsystem_name>`` to spin up a specific subsystem
  - (frontend, backend, services, workers, providers)
- After spinning up the system, you may access the servers:
  - Frontend: http://localhost:3000 --> Prompt up Frontend Web version.
  - Backend: http://localhost:8000 --> This endpoint does not have anything, but you may access http://localhost:8000/docs for documentations on endpoints/APIs, or http://localhost:8000/admin for admin dashboard. 
  - Services: http://localhost:8001 --> This endpoint does not have anything. Major communications are done within docker network. But you can check http://localhost:8001/docs for documentations on endpoints/APIs.
  - Workers: http://localhost:8002 --> This endpoint does not have anything. Major communications are done within docker network. But you can check http://localhost:8002/docs for documentations on endpoints/APIs.
  - Providers: http://localhost:8003 --> This endpoint does not have anything. Major communications are done within docker network. But you can check http://localhost:8003/docs for documentations on endpoints/APIs.

- How to play around with the system
  - ⚠️ Spinning up this project may require substantial resources on disk and require GPU resources (CPU version available)
    - Specifically, the repository uses local LLMs for inferences. The provider subsystem uses & wraps OLLAMA + llama3.1:8b for chat / text inference 11ama3.2:11b for vision.
  - ⚠️ Before trying with endpoints, please run the following command to call OLLAMA once - the first run loads models and consumes several minutes, and any calls made during this time to backend/endpoints will timeout.
      ``` bash
      curl http://localhost:11434/api/generate -d '{"model":"llama3.1:8b","prompt":"Hello"}'
      curl http://localhost:11434/api/generate -d '{"model":"llama3.2-vision:11b","prompt":"What is in this image?","images":[""]}'
      # Image - Or you can insert base64 image if you like in the images field
      ```
  - Try with different subsystems:
    - Backend Subsystem (8000)
      ```
      curl -X POST http://localhost:8000/api/analyze/message -H "Content-Type: application/json" -d '{"message":"Check out this suspicious link"}'
      curl -X POST http://localhost:8000/api/analyze/link -H "Content-Type: application/json" -d '{"url":"http://example.com/malicious"}'

      # App analysis require you to upload to 8003 first, or place it under {PROJ_ROOT}/providers/apks folder
      curl -X POST http://localhost:8000/api/analyze/app -H "Content-Type: application/json" -d -d '{"app_ref":"test.apk","instructions": "Run this app to check if there is any suspicious content."}'
      
      ```  
    - Services Subsystem (8001)
      ```
      curl -X POST http://localhost:8001/analyze_message -H "Content-Type: application/json" -d '{"message":"Check out this suspicious link"}'
      curl -X POST http://localhost:8001/analyze_link      -H "Content-Type: application/json"      -d '{"url":"http://example.com/malicious"}'

      # App analysis require you to upload to 8003 first.
      curl -X POST http://localhost:8001/analyze_app -H "Content-Type: application/json" -d '{"app_ref":"test.apk","instructions": "Run this app to check if there is any suspicious content."}'
      ```
    - Worker Sub-system (8002)
      ```
      curl -X POST -H "Content-Type: application/json" -d '{"worker_type":"link","url":"http://example.com/malicious"}' http://localhost:8002/request_worker
      curl -X POST -H "Content-Type: application/json" -d '{"worker_type":"text","message":"Check this out! http://example.com/malicious"}' http://localhost:8002/request_worker

      # App analysis require you to upload to 8003 first, or place it under {PROJ_ROOT}/providers/apks folder
      curl -X POST -H "Content-Type: application/json" -d '{"worker_type":"app","app_ref":"test.apk","instructions":"Play this game to check if there is any suspicious content."}' http://localhost:8002/request_worker
      ```
    - Providers
      - Try playing around with the emulator directly 
        ```
        # You have to init_device first - terraform will help provisioning the emulator for you
        curl -X POST http://localhost:8003/emulator/init_device
        # Expected Result: {"status":"ok","message":"Device initialized"}
        
        # Then, you need to upload the file to server
        curl -X POST http://localhost:8003/emulator/upload_app -F "file=@./test.apk"
        # Expected Result: {"status":"ok","filename":"test.apk","message":"File already exists"}
        
        # After that, you need to install the APP
        curl -X POST -H "Content-Type: application/json" -d '{"app_ref":"test.apk"}' http://localhost:8003/emulator/install_app
        # Expected Result: {"status":"ok","message":"App test.apk installed."}
        
        # Then you can try run the app
        curl -X POST -H "Content-Type: application/json" -d '{"app_ref":"test.apk"}' http://localhost:8003/emulator/run_app
        # Expected Result: {"status":"success","visuals":{"screenshot":"<base64>"},"events":["tap","scroll","launch"],"task_id":"7ef8a20d-c514-477c-9b12-a64289efe470"}
        ```
- Frontend
Run ``git clone --branch tree git@github.com:wDANDANw/wopa.git`` to clone frontend Flutter/Android build code.

## More Documentations
Please check the (docs)[./docs/General_Concepts_and_Designs] folder for comprehensive documentations, including 
- Project Philosophies
- Project Charter
- Architecture Plans
- Test Plans of Each Subsystem
- And more
